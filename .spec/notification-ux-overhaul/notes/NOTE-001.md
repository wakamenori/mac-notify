---
status: 承認済み
datetime: 2026-02-17 11:55:36
---

## 背景

Specで「カード左端の色塗り」を要求されたが、Tauri 1.8 のネイティブトレイメニューでは任意レイアウト描画ができない。

### 制約

- ネイティブメニューはテキスト中心で、カードUIを直接描画できない。
- 既存実装はバックエンド主体で、フロントは未実装に近い最小構成。

## 決定内容

トレイ左クリックで非表示ウィンドウをポップオーバー表示し、フロント側でカードUI（左端色バー）を描画する方式を採用した。通知分析は受信時に1回だけ実行し、表示時の再分析は行わない。

## 根拠

左端色バーの視覚表現はHTML/CSSであれば正確に実装でき、Specの受け入れ基準（アプリ別親カテゴリ、通知行クリック、クリア機能）をすべて満たせるため。

### 判断軸

- **不可逆性**: 中。UI表示方式をネイティブメニューからポップオーバーに変更した。
- **影響範囲**: `src-tauri/src/main.rs`, `src/main.ts`, `index.html`, `src-tauri/tauri.conf.json`。
- **境界・契約**: RustコマンドAPI（通知一覧取得・クリア）を新規公開。

## 影響

### 肯定的な影響

- 左端色バーを含むカード表現を実装できる。
- 通知単位/アプリ単位/全体クリアをUIから実行できる。
- メニュー表示時のGemini再分析を避け、表示遅延とAPIコストを抑えられる。

### 否定的な影響

- フロント実装量が増え、UI保守対象が増加。
- トレイメニューだけで完結する構成より依存が増える。

### フォローアップ

- 実機でポップオーバーの開閉感（フォーカス喪失で自動非表示）が期待どおりか確認する。
- 通知件数が多いアプリでの描画負荷を観測する。

## 検討した代替案

### 案A

- ネイティブトレイメニューを維持し、色は絵文字や記号で代替する。
- **却下理由**: 左端色バーという明示要件を満たせない。

### 案B

- NativeImageアイコンで疑似的に色を見せる。
- **却下理由**: カードレイアウト自体は作れず、要件の本質を満たせない。

## 参照

- Spec: `.spec/notification-ux-overhaul/spec.md`
- Issue: なし
- PR: なし
